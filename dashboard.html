<!DOCTYPE html>
<html>
<head>
    <title>Coca Cola Interactive Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f9;
            margin: 20px;
        }

        h1 {
            margin-bottom: 30px;
        }

        .layout-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .kpi-box {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
            min-width: 260px;
        }

        .chart-box {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body>

<h1>Coca Cola Interactive Dashboard</h1>

<div class="layout-row">
    <div id="kpiTotalSales" class="kpi-box">Loading total sales...</div>
</div>

<div id="trendChart" class="chart-box"></div>
<div id="productShare" class="chart-box"></div>
<div id="regionSales" class="chart-box"></div>

<script>
// చిన్న utility – "₹/,$" మరియు "," ఉన్న నంబర్ ని clean చేసి number గా మార్చటం
function toNumber(val) {
    if (!val) return 0;
    return Number(
        String(val)
            .replace(/[^0-9.-]/g, "")   // $ , etc తొలగించటం
    );
}

// 1️⃣ Period.csv → Monthly Trend + Total Sales KPI
Plotly.d3.csv("Period.csv", function(err, data) {
    if (err) {
        console.log("Error loading Period.csv", err);
        return;
    }

    // Month, Sales columns మాత్రమే తీసుకోవాలి (Grand Total row ను skip చేస్తాం)
    let months = [];
    let salesVals = [];
    let totalSales = 0;

    data.forEach(row => {
        if (row.Month && row.Month.toLowerCase() !== "grand total") {
            months.push(row.Month);
            let s = toNumber(row.Sales);
            salesVals.push(s);
            totalSales += s;
        }
    });

    // KPI – Total Sales
    document.getElementById("kpiTotalSales").innerHTML =
        "Total Sales: $" + totalSales.toLocaleString();

    // Line chart – Monthly Sales Trend
    let traceTrend = {
        x: months,
        y: salesVals,
        type: "scatter",
        mode: "lines+markers",
        line: { width: 3, color: "#e41a1c" },
        marker: { size: 8 }
    };

    let layoutTrend = {
        title: "Monthly Sales Trend",
        xaxis: { title: "Month" },
        yaxis: { title: "Sales" }
    };

    Plotly.newPlot("trendChart", [traceTrend], layoutTrend);
});

// 2️⃣ Product.csv → Product-wise Sales Pie Chart
Plotly.d3.csv("Product.csv", function(err, data) {
    if (err) {
        console.log("Error loading Product.csv", err);
        return;
    }

    let labels = [];
    let values = [];

    data.forEach(row => {
        if (row.Product && row.Product.toLowerCase() !== "grand total") {
            labels.push(row.Product);
            values.push(toNumber(row.Sales));
        }
    });

    let tracePie = {
        labels: labels,
        values: values,
        type: "pie",
        hoverinfo: "label+percent+value",
        textinfo: "label+percent"
    };

    let layoutPie = {
        title: "Product-wise Sales Share"
    };

    Plotly.newPlot("productShare", [tracePie], layoutPie);
});

// 3️⃣ Region.csv → Region-wise Sales Bar Chart
Plotly.d3.csv("Region.csv", function(err, data) {
    if (err) {
        console.log("Error loading Region.csv", err);
        return;
    }

    let regions = [];
    let regionSales = [];

    data.forEach(row => {
        if (row.Region && row.Region.toLowerCase() !== "grand total") {
            regions.push(row.Region);
            regionSales.push(toNumber(row.Sales));
        }
    });

    let traceBar = {
        x: regions,
        y: regionSales,
        type: "bar",
        marker: { color: "#377eb8" }
    };

    let layoutBar = {
        title: "Regional Sales Comparison",
        xaxis: { title: "Region" },
        yaxis: { title: "Sales" }
    };

    Plotly.newPlot("regionSales", [traceBar], layoutBar);
});
</script>

</body>
</html>
